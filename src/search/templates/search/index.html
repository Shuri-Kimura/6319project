{% extends 'layout_search.html' %}


{% load static %}
{% block  content %}   
<link rel="stylesheet" href="{% static 'search/styles.css' %}">

<h1 class="mt-5 pt-4 text-center">検索</h1>

<div class="d-flex justify-content-center">
  <form class="form-inline my-2" method="POST" action="" id=fixed>
  {% csrf_token %}
  <input type="text" class="form-control ml-3" name="q_class" value="{{request.POST.q_class}}" placeholder="授業キーワード">
  <button type="submit" value="q_class" class="btn btn-primary">検索</button>
  </form>
</div>

<div class="d-flex justify-content-center">
  <form class="form-inline my-2" method="POST" action="" id=fixed>
  {% csrf_token %}
  <input type="text" class="form-control ml-3" name="q_text" value="{{request.POST.q_text}}" placeholder="教科書キーワード">
  <button type="submit" value="q_text" class="btn btn-primary">検索</button>
  </form>
</div>


{% if classes %}
  {% for class in classes %}
  <div class="card mb-4" style="width: 35rem; margin: auto;">
    <div class="card-header nowrap">
      <div class="text-center"><h5><a href="{% url 'classpages:class' class.class_id %}" class="">{{ class.title }} （{{ class.teacher }}）</a></h5></div>
  
      <div class="card-body">
      
        <h5 class="card-title">評価</h5>
        <div>
          <p>理解度　:<span class="star5_rating" data-rate="{{ class.cevals__rikai__avg }}"></span></p>
          <p>単位　　:<span class="star5_rating" data-rate="{{ class.cevals__raku__avg }}"></span></p>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
{% elif texts%}
{% for text in texts %}
  <div class="card mb-4" style="width: 35rem; margin: auto;">
    <div class="card-header nowrap">
      <div class="text-center"><h5>{{ text.title }}</h5></div>

      <div class="card-body">
      
        <h5 class="card-title">概要</h5>
        <div>
          <p>{{ text.info }}</p>
        </div>
      </div>
    </div>
  </div>
  <div class="text">
    <h2>{{ text.title }}</h2>
    <div class="like-outer">
        {% include 'search/like.html' %}
    </div>
    <hr>
  </div>
{% endfor %}
<script type="text/javascript">
  $(document).ready(function(event){
      $(document).on('click', '#like', function(event){
          event.preventDefault();
          $.ajax({
              type: 'POST',
              url: "{% url 'search:tlike' %}",
              data: {
                  'text_id': $(this).attr('name'),
                  'csrfmiddlewaretoken': '{{ csrf_token }}'},
              dataType: 'json',
              success: function(response){
                  selector = document.getElementsByName(response.text_id);
                  if(response.liked){
                      $(selector).html("<i class='fas fa-lg fa-heart'></i>");
                  }
                  else {
                      $(selector).html("<i class='far fa-lg fa-heart'></i>");
                  }
                  selector2 = document.getElementsByName(response.text_id + "-count");
                  $(selector2).text(response.count);
              }
          });
      });
  });
</script>

  <!--
  <section class="section">
    <div class="container">
      <div class="columns is-multiline is-mobile is-tablet is-desktop" style="margin: auto;">
        <div class="column is-12-mobile is-8-tablet is-9-desktop" style="margin: auto;">
          <div class="columns is-multiline is-mobile is-tablet is-desktop" style="margin: auto;">
            {% for text in texts %}
            <div class="column is-6-mobile is-4-tablet is-3-desktop" style="margin: auto;">
              <div class="box">
                {{ text.title }}
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </section> -->

{% else %}
<h5 class="card-title text-center" style="padding-top: 50px;">キーワードに一致する検索結果がありません。</h5>
{% endif %}
{% endblock %}
